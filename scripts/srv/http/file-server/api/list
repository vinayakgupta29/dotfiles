#!/usr/bin/env python3
import os, json, urllib.parse, cgi

root_dirs = {'Downloads': '../Downloads', 'Documents': '../Documents'}

def list_dir(dir_key):
    dir_path = root_dirs.get(dir_key)
    if not dir_path or not os.path.exists(dir_path):
        return []
    items=[]
    for name in os.listdir(dir_path):
        full_path = os.path.join(dir_path, name)
        items.append({
            'name': name,
            'path': os.path.join(dir_key, name),
            'isDirectory': os.path.isdir(full_path),
            'type': guess_type(name, full_path)
        })
    return items

def guess_type(name, full_path):
    if os.path.isdir(full_path): return 'folder'
    ext = name.lower().split('.')[-1]
    if ext in ['jpg','jpeg','png','gif','bmp','webp','svg']: return 'image'
    if ext in ['mp4','webm','avi','mov','mkv']: return 'video'
    if ext in ['mp3','wav','ogg','flac']: return 'audio'
    if ext=='pdf': return 'pdf'
    return 'file'

form = cgi.FieldStorage()
dir_key = form.getfirst('dir','Downloads')
files = list_dir(dir_key)
print("Content-Type: application/json\n")
print(json.dumps({'files': files}))
